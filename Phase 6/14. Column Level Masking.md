# 14. Column Level Masking

Canonical documentation for [14. Column Level Masking](Phase 6/14. Column Level Masking.md). This document defines concepts, terminology, and standard usage.

## Purpose
Column Level Masking (CLM) exists to protect sensitive information within a dataset by obscuring specific data elements while maintaining the overall structure and usability of the data. It addresses the challenge of providing users and applications with the data they need to perform their functions without exposing Personally Identifiable Information (PII), Protected Health Information (PHI), or other sensitive business logic.

The primary goal is to enforce the Principle of Least Privilege (PoLP) at the schema level, ensuring that data exposure is limited based on the context of the requester.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative.

## Scope
This documentation covers the theoretical framework, policy structures, and functional requirements of masking data at the column level.

> [!IMPORTANT]
> **In scope:**
> * Core functionality of dynamic and static masking.
> * Policy-based access control (PBAC) integration.
> * Data transformation types and preservation of data integrity.
> * Theoretical boundaries between masking and encryption.

> [!WARNING]
> **Out of scope:**
> * Specific vendor implementations or proprietary SQL syntax.
> * Row-level security (RLS) logic, except where it intersects with column visibility.
> * Physical disk encryption or network-layer security.

## Definitions
| Term | Definition |
|------|------------|
| Masking Policy | A set of rules defining how data in a specific column should be transformed for different user roles or contexts. |
| Redaction | The process of completely removing or replacing data with a generic placeholder (e.g., "XXXX"). |
| Dynamic Masking | A technique where data is masked on-the-fly at query time; the underlying stored data remains unchanged. |
| Static Masking | A technique where a masked copy of the data is physically created, usually for non-production environments. |
| Deterministic Masking | A masking approach where the same input value always produces the same masked output value, preserving join capabilities. |
| Anonymization | The irreversible removal of identifying information from a dataset. |
| Pseudonymization | Replacing private identifiers with fake identifiers (pseudonyms) to allow for data processing while protecting identity. |

## Core Concepts
The fundamental idea of Column Level Masking is the decoupling of physical data storage from the presentation layer. When a user queries a table, a security interceptor evaluates the user's permissions against the column's masking policy.

> [!TIP]
> Think of Column Level Masking as a "smart lens." The data in the warehouse remains raw and unchanged, but the lens through which the user views the data filters or distorts specific columns based on the user's "clearance level."

### Transformation vs. Removal
Masking is not merely the removal of data. Effective masking preserves the data type and, in many cases, the format of the original data (Format Preserving Encryption/Masking). This allows applications to process the masked data without crashing due to unexpected data types or lengths.

## Standard Model
The standard model for Column Level Masking follows a request-response intercept pattern:

1.  **Request:** A user or application submits a query for a specific dataset.
2.  **Identification:** The system identifies columns within the query that are governed by masking policies.
3.  **Context Evaluation:** The system evaluates the requester's context (Role, IP Address, Time of Day, Purpose).
4.  **Policy Application:**
    *   If the user is authorized, the raw data is returned.
    *   If the user is unauthorized, the specified masking function (e.g., `SHA2`, `Partial Redaction`, `Constant Value`) is applied to the column values.
5.  **Result Set Construction:** The masked values are substituted into the result set.
6.  **Delivery:** The final result set is delivered to the requester.

## Common Patterns
*   **Full Redaction:** Replacing the entire string with a constant (e.g., `NULL` or `CONFIDENTIAL`).
*   **Partial Masking:** Exposing only a portion of the data, such as the last four digits of a Credit Card or Social Security Number.
*   **Hashing:** Replacing the value with a cryptographic hash to allow for equality comparisons without revealing the original value.
*   **Random Substitution:** Replacing values with random data from a lookup table (common in static masking for testing).
*   **Nullification:** Replacing sensitive values with `NULL` to prevent any data leakage while maintaining the column count.

## Anti-Patterns
*   **Masking Primary Keys:** Masking columns used as primary or foreign keys without using deterministic masking can break relational integrity and prevent joins.
*   **Inconsistent Masking:** Applying different masking logic to the same data element across different tables, leading to "data triangulation" where a user can infer the original value.
*   **Masking as Encryption:** Treating masking as a substitute for encryption. Masking is a presentation-layer security measure; it does not protect data from unauthorized physical access to the storage medium.
*   **Over-Masking:** Masking so much data that the dataset becomes useless for its intended analytical or operational purpose.

> [!CAUTION]
> Avoid circular dependencies where a masking policy relies on a lookup table that is itself masked by the same policy. This can lead to infinite loops or query failures.

## Edge Cases
*   **Type Casting:** When a masked value (e.g., a string "MASKED") does not match the original column's data type (e.g., Integer), causing application-level errors.
*   **Inference Attacks:** A user might infer masked data by using `WHERE` clauses or `GROUP BY` statements on masked columns if the system does not properly handle predicate pushdown on masked fields.
*   **Aggregate Leakage:** Masking individual rows but allowing `SUM()` or `AVG()` on the raw data can reveal information about the underlying values through mathematical deduction.
*   **Join Operations:** Joining two tables on a masked column. If the masking is non-deterministic, the join will fail to find matches even if the underlying data is identical.

## Related Topics
*   **Row Level Security (RLS):** Restricting which rows a user can see.
*   **Data Governance:** The broader framework of managing data availability, usability, integrity, and security.
*   **Differential Privacy:** Adding mathematical "noise" to a dataset to prevent individual identification.
*   **Tokenization:** Replacing sensitive data with non-sensitive equivalents (tokens) that have no extrinsic or exploitable meaning.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-01-26 | Initial AI-generated canonical documentation |