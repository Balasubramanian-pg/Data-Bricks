# 12. Table Constraints in Unity Catalog

Canonical documentation for [12. Table Constraints in Unity Catalog](Phase 6/12. Table Constraints in Unity Catalog.md). This document defines concepts, terminology, and standard usage.

## Purpose
Table constraints serve as the formal mechanism for defining and maintaining data integrity within a centralized governance framework. They provide a declarative way to specify the rules that data must follow to be considered valid, ensuring consistency across various data consumers and producers. Beyond data quality, constraints facilitate query optimization and provide essential metadata for Business Intelligence (BI) tools to understand the relationships within a data model.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative regarding the logical application of constraints within the Unity Catalog architecture.

## Scope
This documentation covers the logical definitions, enforcement behaviors, and structural requirements of constraints applied to tables managed by Unity Catalog.

> [!IMPORTANT]
> **In scope:**
> * Primary Key and Foreign Key definitions (Informational)
> * Check Constraints (Enforced)
> * Not Null Constraints (Enforced)
> * Metadata-driven relationship modeling

> [!WARNING]
> **Out of scope:**
> * Specific SQL syntax variations across different compute engines
> * Legacy Hive Metastore constraint behaviors
> * External database constraints not registered within Unity Catalog

## Definitions
| Term | Definition |
|------|------------|
| Primary Key | A column or set of columns that uniquely identifies a row in a table. In Unity Catalog, these are typically informational. |
| Foreign Key | A column or set of columns in one table that refers to the primary key in another table, establishing a relationship. |
| Check Constraint | A Boolean expression that must evaluate to true for every row in a table. |
| Not Null Constraint | A requirement that a specific column cannot contain null values. |
| Informational Constraint | A constraint that is documented in the metadata but not actively enforced during data ingestion. |
| Enforced Constraint | A constraint that is validated by the compute engine during write operations; invalid data causes the operation to fail. |

## Core Concepts
Table constraints in Unity Catalog are categorized by their enforcement level. While some constraints act as "guards" (preventing bad data), others act as "guides" (informing the system and users about the data structure).

**Enforced vs. Informational**
Unity Catalog distinguishes between constraints that the system guarantees (Enforced) and constraints that the user asserts are true (Informational). This distinction is vital for distributed systems where enforcing uniqueness (Primary Keys) can incur significant performance overhead.

**Relationship Discovery**
Constraints allow the catalog to act as a "Source of Truth" for data modeling. By defining Primary and Foreign keys, the catalog enables automated tools to generate Entity Relationship Diagrams (ERDs) and allows query optimizers to perform join elimination.

> [!TIP]
> Think of Informational Constraints as a "contract" between the data producer and the data consumer. The producer promises the data follows the rule, and the consumer (or the optimizer) relies on that promise to simplify complex queries.

## Standard Model
The standard model for constraints in Unity Catalog follows a hierarchical application:

1.  **Column-Level Constraints:** Applied directly to a single column (e.g., `NOT NULL`).
2.  **Table-Level Constraints:** Applied to the table as a whole, often involving multiple columns (e.g., a composite `PRIMARY KEY` or a `CHECK` constraint comparing two columns).

Constraints are stored within the Unity Catalog Metastore as part of the table's metadata. This ensures that regardless of which workspace or compute resource accesses the table, the rules and relationships remain visible and consistent.

## Common Patterns
*   **Star Schema Modeling:** Defining Primary Keys on Dimension tables and Foreign Keys on Fact tables to facilitate BI tool integration.
*   **Data Quality Gates:** Using `CHECK` constraints to ensure numeric values fall within expected ranges (e.g., `age >= 0`) or that strings follow specific formats.
*   **Schema Evolution:** Adding constraints to existing tables to harden data quality as a data product matures.

## Anti-Patterns
*   **Assuming PK Uniqueness Enforcement:** Treating Primary Keys as a mechanism to prevent duplicate records. In Unity Catalog, Primary Keys are informational; the system will not block the insertion of duplicate keys.
*   **Over-Constraining with CHECK:** Implementing overly complex logic in `CHECK` constraints that could be better handled in an ETL/ELT pipeline, leading to difficult-to-debug write failures.
*   **Circular Foreign Keys:** Creating a web of Foreign Key dependencies that make table maintenance and schema evolution unnecessarily complex.

> [!CAUTION]
> Avoid relying on Informational Constraints for critical data validation logic. If the data must be unique for the application to function, uniqueness must be managed at the application or ingestion layer.

## Edge Cases
*   **Identity Columns:** While related to uniqueness, Identity columns are a generation mechanism rather than a constraint, though they are often used in conjunction with Primary Keys.
*   **Complex Data Types:** Constraints (especially `CHECK`) may have limited support or different behavior when applied to nested fields (Structs, Arrays, Maps).
*   **Dropped Tables:** When a table is dropped, its associated constraints are removed from the metastore. However, if a Foreign Key in Table A references Table B, dropping Table B may leave the constraint in Table A in an orphaned or "broken" state depending on the specific implementation's referential integrity checks.
*   **Cross-Catalog References:** Foreign Keys generally must reference tables within the same metastore, and often within the same catalog, to maintain portability and security boundaries.

## Related Topics
*   **Data Lineage:** Constraints provide the structural map that complements the flow of data.
*   **Information Schema:** The standard interface for querying constraint metadata.
*   **Table Access Control (ACL):** Permissions required to define or modify constraints.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-01-26 | Initial AI-generated canonical documentation |